<div class="main-layout" [class.menu-open]="menuOpen()">
  <aside class="sidebar" [class.open]="menuOpen()">
    <div class="profile-card">
      <div class="profile-avatar" aria-hidden="true">{{ userInitials() }}</div>
      <div class="profile-meta">
        <p class="profile-name">{{ access.displayName() }}</p>
        <p class="profile-role">{{ roleLabel() }}</p>
      </div>
    </div>

    <nav class="menu">
      <div class="menu-section">
        <button
          type="button"
          class="menu-section-header"
          (click)="toggleGroup('operaciones')"
          [attr.aria-expanded]="isGroupOpen('operaciones')"
          aria-controls="menu-operaciones"
        >
          <span class="menu-section-title">
            <span class="menu-group-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <rect x="3" y="4" width="18" height="16" rx="2"></rect>
                <path d="M8 2v4"></path>
                <path d="M16 2v4"></path>
                <path d="M3 10h18"></path>
              </svg>
            </span>
            Operaciones
          </span>
          <span class="menu-section-chevron">{{ isGroupOpen('operaciones') ? '-' : '+' }}</span>
        </button>
        @if (isGroupOpen('operaciones')) {
          <div class="menu-subnav" id="menu-operaciones">
            @if (can('dashboard')) {
              <a
                routerLink="/main/dashboard"
                routerLinkActive="active"
                [routerLinkActiveOptions]="{ exact: true }"
                (click)="closeMenu()"
              >
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="7" height="9"></rect>
                    <rect x="14" y="3" width="7" height="5"></rect>
                    <rect x="14" y="12" width="7" height="9"></rect>
                    <rect x="3" y="16" width="7" height="5"></rect>
                  </svg>
                </span>
                <span>Dashboard</span>
              </a>
            }
            @if (can('pedidos')) {
              <a routerLink="/main/pedidos" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 7h18"></path>
                    <path d="M3 12h18"></path>
                    <path d="M3 17h12"></path>
                  </svg>
                </span>
                <span>Pedidos</span>
              </a>
            }
            @if (can('validacion')) {
              <a routerLink="/main/validacion" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="m20 6-11 11-5-5"></path>
                  </svg>
                </span>
                <span>Validacion</span>
              </a>
            }
            @if (can('clientas')) {
              <a routerLink="/main/clientas" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"></path>
                    <circle cx="9" cy="7" r="4"></circle>
                    <path d="M20 8v6"></path>
                    <path d="M23 11h-6"></path>
                  </svg>
                </span>
                <span>Clientes</span>
              </a>
            }
          </div>
        }
      </div>

      <div class="menu-section">
        <button
          type="button"
          class="menu-section-header"
          (click)="toggleGroup('logistica')"
          [attr.aria-expanded]="isGroupOpen('logistica')"
          aria-controls="menu-logistica"
        >
          <span class="menu-section-title">
            <span class="menu-group-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="12" cy="5" r="2"></circle>
                <circle cx="5" cy="19" r="2"></circle>
                <circle cx="19" cy="19" r="2"></circle>
                <path d="M12 7v6"></path>
                <path d="M12 13 7 17"></path>
                <path d="M12 13l5 4"></path>
              </svg>
            </span>
            Red de Distribucion
          </span>
          <span class="menu-section-chevron">{{ isGroupOpen('logistica') ? '-' : '+' }}</span>
        </button>
        @if (isGroupOpen('logistica')) {
          <div class="menu-subnav" id="menu-logistica">
            @if (can('inventario')) {
              <a routerLink="/main/inventario" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 7.5 12 3l9 4.5-9 4.5L3 7.5z"></path>
                    <path d="M3 12l9 4.5L21 12"></path>
                    <path d="M3 16.5 12 21l9-4.5"></path>
                  </svg>
                </span>
                <span>Inventario</span>
              </a>
            }
            @if (can('rutas')) {
              <a routerLink="/main/rutas" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 20h18"></path>
                    <circle cx="7" cy="20" r="1"></circle>
                    <circle cx="17" cy="20" r="1"></circle>
                    <path d="M5 20V8h8"></path>
                    <path d="M13 8h6l2 5h-8z"></path>
                  </svg>
                </span>
                <span>Rutas</span>
              </a>
            }
            @if (can('localidades')) {
              <a routerLink="/main/localidades" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 21s7-5.5 7-11a7 7 0 1 0-14 0c0 5.5 7 11 7 11z"></path>
                    <circle cx="12" cy="10" r="2.5"></circle>
                  </svg>
                </span>
                <span>Localidades</span>
              </a>
            }
          </div>
        }
      </div>

      <div class="menu-section">
        <button
          type="button"
          class="menu-section-header"
          (click)="toggleGroup('catalogo')"
          [attr.aria-expanded]="isGroupOpen('catalogo')"
          aria-controls="menu-catalogo"
        >
          <span class="menu-section-title">
            <span class="menu-group-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5V4.5A2.5 2.5 0 0 1 6.5 2z"></path>
              </svg>
            </span>
            Catalogo
          </span>
          <span class="menu-section-chevron">{{ isGroupOpen('catalogo') ? '-' : '+' }}</span>
        </button>
        @if (isGroupOpen('catalogo')) {
          <div class="menu-subnav" id="menu-catalogo">
            @if (can('catalogo')) {
              <a routerLink="/main/catalogo" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                    <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5V4.5A2.5 2.5 0 0 1 6.5 2z"></path>
                  </svg>
                </span>
                <span>Productos</span>
              </a>
            }
            @if (can('categorias')) {
              <a routerLink="/main/categorias" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 12h18"></path>
                    <path d="M3 6h18"></path>
                    <path d="M3 18h18"></path>
                  </svg>
                </span>
                <span>Categorias</span>
              </a>
            }
            @if (can('proveedores')) {
              <a routerLink="/main/proveedores" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 7h-9"></path>
                    <path d="M14 17H5"></path>
                    <circle cx="17" cy="17" r="3"></circle>
                    <circle cx="7" cy="7" r="3"></circle>
                  </svg>
                </span>
                <span>Proveedores</span>
              </a>
            }
          </div>
        }
      </div>

      @if (can('usuarios')) {
        <div class="menu-section">
          <button
            type="button"
            class="menu-section-header"
            (click)="toggleGroup('configuracion')"
            [attr.aria-expanded]="isGroupOpen('configuracion')"
            aria-controls="menu-configuracion"
          >
            <span class="menu-section-title">
              <span class="menu-group-icon" aria-hidden="true">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                  <circle cx="12" cy="12" r="3"></circle>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.04.04a2 2 0 1 1-2.83 2.83l-.04-.04a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.06a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.04.04a2 2 0 1 1-2.83-2.83l.04-.04A1.65 1.65 0 0 0 4.6 15a1.65 1.65 0 0 0-1.5-1H3a2 2 0 1 1 0-4h.1a1.65 1.65 0 0 0 1.5-1 1.65 1.65 0 0 0-.33-1.82l-.04-.04a2 2 0 1 1 2.83-2.83l.04.04a1.65 1.65 0 0 0 1.82.33h.05a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.06a1.65 1.65 0 0 0 1 1.51h.05a1.65 1.65 0 0 0 1.82-.33l.04-.04a2 2 0 1 1 2.83 2.83l-.04.04a1.65 1.65 0 0 0-.33 1.82v.05a1.65 1.65 0 0 0 1.51 1H21a2 2 0 1 1 0 4h-.06a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
              </span>
              Configuracion
            </span>
            <span class="menu-section-chevron">{{ isGroupOpen('configuracion') ? '-' : '+' }}</span>
          </button>
          @if (isGroupOpen('configuracion')) {
            <div class="menu-subnav" id="menu-configuracion">
              <a routerLink="/main/usuarios" routerLinkActive="active" (click)="closeMenu()">
                <span class="menu-item-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                    <circle cx="8.5" cy="7" r="3.5"></circle>
                    <path d="M20 8v6"></path>
                    <path d="M23 11h-6"></path>
                  </svg>
                </span>
                <span>Usuarios</span>
              </a>
            </div>
          }
        </div>
      }
    </nav>

    <div class="sidebar-footer">
      <button type="button" class="menu-footer-action" (click)="logout()">
        <span class="menu-item-icon" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
            <path d="m16 17 5-5-5-5"></path>
            <path d="M21 12H9"></path>
          </svg>
        </span>
        <span>Cerrar sesion</span>
      </button>
    </div>
  </aside>

  <div class="content-wrapper">
    <header class="topbar">
      <button type="button" class="menu-toggle" (click)="toggleMenu()" aria-label="Abrir o cerrar menu">
        {{ menuOpen() ? 'Cerrar' : 'Menu' }}
      </button>
      <span class="topbar-title">Administracion</span>
    </header>

    <main class="content" (click)="closeMenu()">
      <router-outlet />
    </main>
  </div>
</div>

@if (menuOpen()) {
  <button
    type="button"
    class="backdrop"
    aria-label="Cerrar menu"
    (click)="closeMenu()"
  ></button>
}
